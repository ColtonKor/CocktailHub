<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile Page</title>
  </head>

  <body>
    <h1>Profile Info</h1>
    <%-include("partials/nav.ejs")%>
    <br /><br />

    <div class="posts-container">
      <% if (posts && posts.length > 0) { %> <% for (let i = 0; i <
      posts.length; i++) { %>
      <div class="post" id="postBackground">
        <strong>User:</strong> <%= posts[i].username %>
        <div class="content">
          <p><%= posts[i].content %></p>
        </div>
        <div class="caption">
          <p><%= posts[i].caption %></p>
        </div>
        <br />
        <div class="post-footer">
          <figure>
            <form action="/like" method="POST">
              <input
                type="hidden"
                name="postId"
                value="<%= posts[i].postId %>"
              />
              <button
                type="submit"
                style="background: none; border: none; cursor: pointer"
              >
                ❤️ <%= posts[i].likes %>
              </button>
            </form>
          </figure>
          <figure>
            <span
              >Posted: <%= new Date(posts[i].datePosted).toLocaleDateString()
              %></span
            >
          </figure>
          <figure>
            <button class="toggle">Open Comments</button>
          </figure>
        </div>
        <br />
        <div class="comments-section">
          <form action="/comment" method="POST">
            <input type="hidden" name="postId" value="<%= posts[i].postId %>" />
            <textarea
              name="commentContent"
              placeholder="Add your comment..."
              required
            ></textarea>
            <button type="submit">Post Comment</button>
          </form>
          <h4>Comments:</h4>
          <% const postComments = comments.filter(comment => comment.postId ===
          posts[i].postId); %> <% if (postComments.length > 0) { %> <% for (let
          j = 0; j < postComments.length; j++) { %>
          <div class="comment">
            <strong><%= postComments[j].username %>:</strong>
            <p><%= postComments[j].text %></p>
            <form action="/likeComment" method="POST">
              <input
                type="hidden"
                name="commentId"
                value="<%= postComments[j].commentId %>"
              />
              <button
                type="submit"
                style="background: none; border: none; cursor: pointer"
              >
                ❤️ <%= postComments[j].likes %>
              </button>
            </form>
          </div>
          <% } %> <% } else { %>
          <p>No comments yet!</p>
          <% } %>
        </div>
      </div>
      <br /><br /><br />
      <% } %> <% } else { %>
      <p>No posts yet!</p>
      <% } %>
    </div>
  </body>
</html>
